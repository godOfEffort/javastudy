# Optional
## Optional 적용패턴
### Optional 객체 만들기
1) 빈 Optional
``` 
   Optional<Car> optCar = Optional.empty();
```
2) null이 아닌 값으로 Optional 만들기
정적 팩토리 메서드 Optional.of로 null이 아닌 값을 포함하는 Optional을 만들 수 있다.
``` 
   Optional<Car> optCar = Optional.of(car);
```
이제 car가 null이라면 즉시 NullPointerException이 발생한다.

3) null 값으로 Optional 만들기
정적 팩토리 메서드 Optional.of로 null이 아닌 값을 포함하는 Optional을 만들 수 있다.
``` 
   Optional<Car> optCar = Optional.ofNullable(car);
```
car가 null이면 빈 Optional 객체가 반환된다.

### 맵으로 Optional의 값을 추출하고 변환하기
``` 
   String name = null;
   if(insurance != null) {
        name = insurance.getName();
   }
```
이런 유형의 패턴에 사용할 수 있도록 Optional에서 map 메서드 지원
```
   Optional<Insurance> optInsurance = Optional.ofNullable(insurance);
   Optional<String> name = optInsurance.map(Insurance::getName);   
```
스트림의 map은 스트림의 각 요소에 제공된 함수를 적용하는 연산이다. Optional 객체를
최대 요소의 개수가 한 개 이하인 데이터 컬렉션으로 생각. Optional이 값을 포함하면
map의 인수로 제공된 함수가 값을 바꾼다. Optional이 비어 있으면 아무 일도 일어나지 않는다.

### flatMap으로 Optional 객체 연결
```
   Optional<Person> optPerson = Optional.of(person);
   Optional<String> name =
        optPerson.map(Person::getCar)
                 .map(Car::getInsurance)
                 .map(Insurance::getName); 
```
위 코드는 컴파일 되지 않는데 getCar의 결과가 Optional<Optional<Car>> 형식의 객체를 반환하기 때문이다.
스트림의 flatMap은 함수를 인수로 받아서 다른 스트림을 반환하는 메서드. 보통 인수로 받은 함수를 
스트림의 각 요소에 적용하면 스트림의 스트림이 만들어진다. 하지만 flatMap은 인수로 받은 함수를
적용해서 생성된 각각의 스트림에서 콘텐츠만 남긴다.

```
   public String getCarInsuracneName(Optional<Person> person) {
        return perosn.flatMap(Person::getCar)
                     .flatMap(Car::getInsurance)
                     .map(Insurance::getName)
                     .orElse("Unkonwn");
   }
```
